<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Khảo sát & Trắc nghiệm | Drug Prevention Support System</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome & Google Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2176ae;
            --secondary: #57b8ff;
            --bg: #f7fbfd;
            --white: #fff;
            --soft: #eaf4fa;
            --shadow: 0 6px 32px 0 rgba(33,118,174,0.13);
        }
        html, body { width: 100%; min-width: 0; overflow-x: hidden !important; box-sizing: border-box;}
        * { box-sizing: inherit; }
        body {
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            margin: 0;
            color: #24415d;
        }
        .main-wrap {
            max-width: 1440px;
            width: 90vw;
            margin: 0 auto;
            padding: 0 0 60px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .section {
            width: 100%;
            margin: 38px 0 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 28px;
            text-align: center;
            letter-spacing: 0.02em;
            text-shadow: 0 1px 10px #2176ae14;
            animation: titleFade 1s;
        }
        @keyframes titleFade {
            from { opacity: 0; transform: translateY(-18px);}
            to   { opacity: 1; transform: translateY(0);}
        }
        .survey-filter-bar {
            background: #fff;
            box-shadow: 0 2px 12px #2176ae15;
            border-radius: 14px;
            padding: 19px 34px 10px 34px;
            display: flex;
            gap: 18px;
            margin-bottom: 27px;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 10;
        }
        .survey-filter-bar select, .survey-filter-bar input[type="text"] {
            font-family: inherit;
            border-radius: 8px;
            border: 1px solid #b7d8f5;
            font-size: 1.03em;
            padding: 7px 16px;
            background: #f4fbff;
            color: #274060;
            outline: none;
            margin-right: 8px;
        }
        .survey-filter-bar input[type="text"] { width: 195px; }
        .survey-grid {
            width: 100%;
            max-width: 1260px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 36px;
            margin: 0 auto 24px auto;
            align-items: stretch;
        }
        .survey-card {
            background: var(--white);
            border-radius: 17px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-height: 288px;
            padding: 0 0 22px 0;
            transition: box-shadow 0.17s, transform 0.13s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: surveyFadeIn 0.55s;
        }
        @keyframes surveyFadeIn {
            from { opacity:0; transform:scale(0.97) translateY(28px);}
            to { opacity:1; transform:scale(1) translateY(0);}
        }
        .survey-card:active { transform: scale(0.97);}
        .survey-card:focus-within { outline: 2px solid var(--secondary);}
        .survey-card:hover {
            box-shadow: 0 16px 42px #2176ae16;
            transform: translateY(-4px) scale(1.014);
        }
        .survey-ribbon {
            position: absolute;
            top: 19px; left: -36px;
            background: linear-gradient(90deg, #21ae66 60%, #57b8ff 100%);
            color: #fff;
            font-weight: 700;
            font-size: 1.01em;
            padding: 6px 58px 6px 50px;
            transform: rotate(-19deg);
            border-radius: 8px 22px 12px 0;
            box-shadow: 0 3px 10px #57b8ff25;
            letter-spacing: 0.04em;
            z-index: 2;
            animation: popIn 0.65s;
        }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8) rotate(-19deg);}
            to   { opacity: 1; transform: scale(1) rotate(-19deg);}
        }
        .survey-card-img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-top-left-radius: 17px;
            border-top-right-radius: 17px;
            background: #eaf6fa;
            box-shadow: 0 2px 10px #57b8ff0f;
        }
        .survey-card-body {
            padding: 19px 21px 0 21px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }
        .survey-title {
            font-size: 1.20em;
            font-weight: 800;
            color: #1c2f49;
            margin-bottom: 10px;
        }
        .survey-type {
            font-size: 0.98em;
            color: #2176ae;
            font-weight: 600;
            background: #e6f4fa;
            border-radius: 7px;
            padding: 2.5px 11px;
            margin-bottom: 7px;
            display: inline-block;
        }
        .survey-topic {
            font-size: 0.97em;
            color: #57b8ff;
            font-weight: 500;
            margin-left: 7px;
        }
        .survey-desc {
            font-size: 1.01em;
            color: #4b637f;
            margin-bottom: 13px;
        }
        .survey-card-footer {
            margin-top: auto;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: space-between;
        }
        .survey-info {
            color: #6fa3ce;
            font-size: 0.97em;
            display: flex;
            align-items: center;
            gap: 7px;
        }
        .survey-btn {
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(90deg, #2176ae 85%, #57b8ff 100%);
            color: #fff;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.15s, box-shadow 0.13s, transform 0.13s;
            box-shadow: 0 1px 5px #2176ae18;
        }
        .survey-btn:active { transform: scale(0.97);}
        .survey-btn:hover {
            background: linear-gradient(90deg, #21ae66 80%, #3eaafc 100%);
            box-shadow: 0 4px 13px #21ae6624;
            transform: scale(1.04);
        }
        #noSurveyMsg {
            display: none;
            color: #57b8ff;
            font-weight: 500;
            font-size: 1.13em;
            text-align: center;
            padding: 28px 0 0 0;
        }
        /* Responsive */
        @media (max-width: 1100px) {
            .main-wrap { width: 98vw;}
            .survey-grid { max-width: 99vw;}
        }
        @media (max-width: 900px) {
            .main-wrap { width: 99vw;}
        }
        @media (max-width: 650px) {
            .section-title { font-size: 1.4rem;}
            .main-wrap { width: 100vw;}
            .survey-filter-bar { flex-direction: column; gap: 10px; padding: 12px 6px 7px 6px;}
            .survey-grid { gap: 14px;}
        }
    </style>
</head>
<body>
<div th:replace="member/header :: main-header"></div>
<div class="main-wrap">
    <section class="section">
        <div class="section-title">
            <i class="fa-solid fa-clipboard-list"></i> Danh sách Khảo sát & Trắc nghiệm
        </div>
        <div class="survey-filter-bar" id="surveyFilterBar">
            <select id="filterType">
                <option value="">Tất cả loại</option>
                <option value="Trắc nghiệm">Trắc nghiệm</option>
                <option value="Đánh giá mức độ">Đánh giá mức độ</option>
                <option value="Tự luận">Tự luận</option>
                <option value="Tổng hợp">Tổng hợp</option>
            </select>
            <select id="filterTopic">
                <option value="">Tất cả chủ đề</option>
                <option value="Nhận thức về ma túy">Nhận thức về ma túy</option>
                <option value="Kỹ năng phòng tránh">Kỹ năng phòng tránh</option>
                <option value="Tâm lý - hành vi">Tâm lý - hành vi</option>
            </select>
            <input id="searchInput" type="text" placeholder="Tìm kiếm khảo sát...">
        </div>
    </section>
    <section class="section">
        <div class="survey-grid" id="surveyGrid">
            <!-- CARD DATA DYNAMICALLY GENERATED BY JS -->
        </div>
        <div id="noSurveyMsg">Không tìm thấy khảo sát nào phù hợp.</div>
    </section>
</div>
<div th:replace="member/footer :: main-footer"></div>
<script>
    // Dữ liệu khảo sát mẫu đa dạng
    const surveysData = [
        {
            id: 1,
            title: "Khảo sát ASSIST",
            type: "Trắc nghiệm",
            topic: "Nhận thức về ma túy",
            desc: "Khảo sát ngắn giúp đánh giá nguy cơ sử dụng ma túy qua 8 câu hỏi khách quan.",
            img: "https://cdn-icons-png.flaticon.com/512/3986/3986986.png",
            hot: true,
            ribbon: "Hot"
        },
        {
            id: 2,
            title: "Test CRAFFT",
            type: "Đánh giá mức độ",
            topic: "Tâm lý - hành vi",
            desc: "Bộ câu hỏi dành cho thanh thiếu niên, đánh giá nguy cơ nghiện và hành vi nguy cơ.",
            img: "https://cdn-icons-png.flaticon.com/512/6064/6064090.png",
            hot: true,
            ribbon: "Mới"
        },
        {
            id: 3,
            title: "Tự luận: Suy nghĩ về ma túy",
            type: "Tự luận",
            topic: "Nhận thức về ma túy",
            desc: "Viết đoạn văn chia sẻ suy nghĩ và kiến thức của bạn về phòng tránh ma túy.",
            img: "https://cdn-icons-png.flaticon.com/512/3145/3145765.png",
            ribbon: ""
        },
        {
            id: 4,
            title: "Trắc nghiệm kỹ năng phòng tránh",
            type: "Trắc nghiệm",
            topic: "Kỹ năng phòng tránh",
            desc: "Đánh giá khả năng xử lý tình huống và kỹ năng phòng chống.",
            img: "https://cdn-icons-png.flaticon.com/512/3597/3597074.png",
            ribbon: "Đề xuất"
        },
        {
            id: 5,
            title: "Bài tổng hợp phòng chống",
            type: "Tổng hợp",
            topic: "Nhận thức về ma túy",
            desc: "Kết hợp trắc nghiệm, bài luận và câu hỏi tình huống thực tế cho mọi đối tượng.",
            img: "https://cdn-icons-png.flaticon.com/512/2462/2462719.png",
            ribbon: ""
        },
        {
            id: 6,
            title: "Tự luận: Câu chuyện phòng ngừa",
            type: "Tự luận",
            topic: "Kỹ năng phòng tránh",
            desc: "Kể về một trường hợp bạn từng biết giúp phòng ngừa hiệu quả.",
            img: "https://cdn-icons-png.flaticon.com/512/3534/3534138.png",
            ribbon: ""
        },
        {
            id: 7,
            title: "Đánh giá hành vi nguy cơ",
            type: "Đánh giá mức độ",
            topic: "Tâm lý - hành vi",
            desc: "Tự đánh giá hành vi bản thân và nhận phản hồi từ chuyên gia.",
            img: "https://cdn-icons-png.flaticon.com/512/3135/3135731.png",
            ribbon: ""
        }
    ];

    // Render khảo sát
    function renderSurveys(filterType = '', filterTopic = '', keyword = '') {
        const grid = document.getElementById('surveyGrid');
        const noMsg = document.getElementById('noSurveyMsg');
        grid.innerHTML = '';
        let count = 0;
        surveysData.forEach(survey => {
            let matched = true;
            if (filterType && survey.type !== filterType) matched = false;
            if (filterTopic && survey.topic !== filterTopic) matched = false;
            if (keyword && !survey.title.toLowerCase().includes(keyword.toLowerCase()) && !survey.desc.toLowerCase().includes(keyword.toLowerCase())) matched = false;
            if (!matched) return;
            count++;

            const card = document.createElement('div');
            card.className = 'survey-card';
            card.tabIndex = 0;

            // Ribbon (Hot/Mới/Đề xuất...)
            if(survey.ribbon) {
                const ribbon = document.createElement('span');
                ribbon.className = 'survey-ribbon';
                ribbon.textContent = survey.ribbon;
                card.appendChild(ribbon);
            }

            // Ảnh khảo sát
            const img = document.createElement('img');
            img.className = 'survey-card-img';
            img.src = survey.img;
            img.alt = survey.title;
            card.appendChild(img);

            // Body
            const body = document.createElement('div');
            body.className = 'survey-card-body';
            body.innerHTML = `
                <div class="survey-title">${survey.title}</div>
                <span class="survey-type">${survey.type}</span>
                <span class="survey-topic"><i class="fa fa-hashtag"></i> ${survey.topic}</span>
                <div class="survey-desc">${survey.desc}</div>
                <div class="survey-card-footer">
                    <div class="survey-info"><i class="fa fa-question-circle"></i> ${survey.type === 'Trắc nghiệm' ? '8-10 câu' : survey.type === 'Tự luận' ? '1 bài tự luận' : survey.type === 'Đánh giá mức độ' ? '6-7 câu điểm số' : 'Tổng hợp nhiều dạng'}</div>
                    <button class="survey-btn" tabindex="0">Bắt đầu</button>
                </div>
            `;
            card.appendChild(body);

            // Nút hiệu ứng
            card.querySelector('.survey-btn').addEventListener('click', function(e) {
                e.preventDefault();
                this.textContent = "Đang mở...";
                this.style.background = "linear-gradient(90deg, #21ae66 80%, #57b8ff 100%)";
                setTimeout(() => {
                    this.textContent = "Bắt đầu";
                    this.style.background = "";
                }, 750);
            });

            // Card hover mượt hơn
            card.addEventListener('mousedown', () => card.classList.add('pressed'));
            card.addEventListener('mouseup', () => card.classList.remove('pressed'));
            card.addEventListener('mouseleave', () => card.classList.remove('pressed'));

            grid.appendChild(card);
        });
        noMsg.style.display = count === 0 ? '' : 'none';
    }

    // Sự kiện filter/tìm kiếm
    document.addEventListener('DOMContentLoaded', function() {
        const filterType = document.getElementById('filterType');
        const filterTopic = document.getElementById('filterTopic');
        const searchInput = document.getElementById('searchInput');
        function doFilter() {
            renderSurveys(filterType.value, filterTopic.value, searchInput.value.trim());
            window.scrollTo({ top: document.querySelector('.main-wrap').offsetTop, behavior: 'smooth' });
        }
        filterType.addEventListener('change', doFilter);
        filterTopic.addEventListener('change', doFilter);
        searchInput.addEventListener('input', doFilter);
        renderSurveys(); // Initial render
    });
</script>
</body>
</html>
