<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Quản lý khóa học</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
    /* Bảng màu xanh dương chuyên nghiệp */
    --primary-100: #e6f0ff;
    --primary-200: #b3d1ff;
    --primary-300: #80b3ff;
    --primary-400: #4d94ff;
    --primary-500: #1a75ff;  /* Màu chính */
    --primary-600: #0066e6;
    --primary-700: #0052b3;
    --primary-800: #003d80;
    --primary-900: #00294d;
    
    /* Màu hỗ trợ */
    --secondary: #5bc0de;
    --success: #28a745;
    --info: #17a2b8;
    --warning: #ffc107;
    --danger: #dc3545;
    --light: #f8f9fa;
    --dark: #343a40;
    
    /* Màu text */
    --text-primary: #212529;
    --text-secondary: #495057;
    
    /* Border */
    --border-color: #dee2e6;
    --border-radius: 0.375rem;
    
    /* Shadow */
    --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
}

body {
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    background-color: #f5f8fa;
    color: var(--text-primary);
    line-height: 1.6;
}

/* Card */
.card {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
    overflow: hidden;
}

.card:hover {
    box-shadow: var(--shadow);
}

.card-header {
    background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
    color: white;
    padding: 1rem 1.5rem;
    border-bottom: none;
}

/* Table */
.table-responsive {
    border-radius: var(--border-radius);
    overflow: hidden;
}

.table {
    margin-bottom: 0;
    border-collapse: separate;
    border-spacing: 0;
}

.table thead {
    background: linear-gradient(to right, var(--primary-600), var(--primary-800));
    color: white;
}

.table th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.5px;
    padding: 1rem;
    border: none;
}

.table td {
    padding: 0.75rem 1rem;
    vertical-align: middle;
    border-top: 1px solid var(--border-color);
}

.table-hover tbody tr:hover {
    background-color: var(--primary-100);
}

.table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(0, 123, 255, 0.05);
}

/* Buttons */
.btn {
    font-weight: 500;
    border-radius: var(--border-radius);
    padding: 0.5rem 1rem 0.5rem 1.25rem !important;
    transition: all 0.3s ease;
    box-shadow: none;
    border: none;
}

.btn-primary {
    background-color: var(--primary-500);
}

.btn-primary:hover {
    background-color: var(--primary-600);
    transform: translateY(-1px);
}

.btn-outline-primary {
    color: var(--primary-500);
    border: 1px solid var(--primary-500);
}

.btn-outline-primary:hover {
    background-color: var(--primary-500);
    color: white;
}

.btn-warning {
    background-color: var(--warning);
    color: var(--dark);
}

.btn-danger {
    background-color: var(--danger);
}

.btn-light {
    background-color: var(--light);
    color: var(--primary-500);
}

.btn-light:hover {
    background-color: #e9ecef;
    color: var(--primary-600);
}

/* Modal */
.modal-content {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
}

.modal-header {
    background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
    color: white;
    border-bottom: none;
}

.modal-title {
    font-weight: 600;
}

/* Form */
.form-control, .form-select {
    border-radius: var(--border-radius);
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-300);
    box-shadow: 0 0 0 0.25rem rgba(26, 117, 255, 0.25);
}

/* Alert */
.alert {
    border-radius: var(--border-radius);
    border: none;
}

.alert-success {
    background-color: rgba(40, 167, 69, 0.15);
    color: #28a745;
}

.alert-danger {
    background-color: rgba(220, 53, 69, 0.15);
    color: #dc3545;
}

/* Image thumbnail */
.img-thumbnail {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid var(--border-color);
}

/* Action buttons */
.action-buttons .btn {
    margin-right: 0.5rem;
    min-width: 80px;
}

/* Description cell */
.description-cell {
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Empty state */
.empty-state {
    padding: 3rem;
    text-align: center;
    color: #6c757d;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #dee2e6;
}

/* Responsive */
@media (max-width: 768px) {
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .action-buttons .btn {
        width: 100%;
        margin-right: 0;
    }
    
    .table-responsive {
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
    }
}

    </style>
</head>
<body>
    <header th:replace="staff/header :: main-header"></header>

<div class="container-fluid mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Quản lý khóa học</h2>
                <button class="btn btn-light" onclick="resetForm()" data-bs-toggle="modal" data-bs-target="#courseModal">
                    <i class="bi bi-plus-lg"></i> Thêm mới
                </button>
            </div>
        </div>
        
        <div class="card-body">
            <!-- Thông báo -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-blue">
                        <tr>
                            <th>STT</th>
                            <th>Tên</th>
                            <th>Mô tả</th>
                            <th>Đối tượng</th>
                            <th>Chủ đề</th>
                            <th>Tham gia</th>
                            <th>Ngày tạo</th>
                            <th>Ảnh</th>
                            <th>Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="course, stat : ${courses}">
                            <td th:text="${stat.count}"></td>
                            <td th:text="${course.name}"></td>
                            <td class="description-cell" th:text="${course.description}"></td>
                            <td th:text="${course.targetObject}"></td>
                            <td th:text="${course.topic}"></td>
                            <td th:text="${course.participants}"></td>
                            <td th:text="${#temporals.format(course.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                            <td>
                                <img th:if="${course.image}" th:src="${course.image}" class="img-thumbnail" alt="Ảnh khóa học">
                            </td>
                            <td class="action-buttons">
                                <button class="btn btn-sm btn-warning" 
                                        onclick="prepareEditModal([[${course.id}]])">
                                    <i class="bi bi-pencil"></i> Sửa
                                </button>
                                <form th:action="@{'/staff/courses/delete/' + ${course.id}}" method="post" style="display:inline;">
                                    <button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Bạn chắc chắn muốn xóa?')">
                                        <i class="bi bi-trash"></i> Xóa
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(courses)}">
                            <td colspan="9" class="text-center text-muted">Không có khóa học nào</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal chung cho Thêm/Sửa -->
<div class="modal fade" id="courseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="courseForm" action="/staff/courses/save" method="post">
                <input type="hidden" name="id" id="courseId">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Thêm khóa học mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Tên khóa học <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Chủ đề</label>
                            <input type="text" class="form-control" name="topic">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Mô tả</label>
                            <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Đối tượng</label>
                            <input type="text" class="form-control" name="targetObject">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Số người tham gia</label>
                            <input type="number" class="form-control" name="participants">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Video 1 (URL)</label>
                            <input type="url" class="form-control" name="video1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Video 2 (URL)</label>
                            <input type="url" class="form-control" name="video2">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Video 3 (URL)</label>
                            <input type="url" class="form-control" name="video3">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Ảnh (URL)</label>
                            <input type="url" class="form-control" name="image">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Reset form và chuẩn bị cho thêm mới
    function resetForm() {
        document.getElementById('courseForm').reset();
        document.getElementById('courseId').value = '';
        document.getElementById('modalTitle').textContent = 'Thêm khóa học mới';
    }

    // Chuẩn bị dữ liệu cho modal sửa
    function prepareEditModal(courseId) {
        fetch('/staff/courses/get/' + courseId)
            .then(response => {
                if (!response.ok) throw new Error('Không tìm thấy khóa học');
                return response.json();
            })
            .then(data => {
                if (data) {
                    // Điền dữ liệu vào form
                    document.getElementById('courseId').value = data.id;
                    document.querySelector('input[name="name"]').value = data.name || '';
                    document.querySelector('textarea[name="description"]').value = data.description || '';
                    document.querySelector('input[name="targetObject"]').value = data.targetObject || '';
                    document.querySelector('input[name="topic"]').value = data.topic || '';
                    document.querySelector('input[name="video1"]').value = data.video1 || '';
                    document.querySelector('input[name="video2"]').value = data.video2 || '';
                    document.querySelector('input[name="video3"]').value = data.video3 || '';
                    document.querySelector('input[name="participants"]').value = data.participants || '';
                    document.querySelector('input[name="image"]').value = data.image || '';
                    
                    // Cập nhật tiêu đề modal
                    document.getElementById('modalTitle').textContent = 'Sửa khóa học';
                    
                    // Mở modal
                    const modal = new bootstrap.Modal(document.getElementById('courseModal'));
                    modal.show();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Không thể tải dữ liệu khóa học');
            });
    }

    // Reset form khi modal đóng
    document.getElementById('courseModal').addEventListener('hidden.bs.modal', resetForm);
</script>
</body>
</html>