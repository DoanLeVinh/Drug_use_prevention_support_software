<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chi tiết bài khảo sát</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .inline-form { display: inline-block; width: auto; margin: 0; }
        .inline-edit { background: #f3fafd; border-radius: 8px; padding: 8px; margin-bottom: 12px;}
        .answer-row { margin-left: 20px;}
    </style>
</head>
<body>
<div th:replace="admin/header :: main-header"></div>
<div class="container mt-4">
    <!-- Form chỉnh sửa thông tin bài test -->
    <form th:action="@{|/admin/tests/save|}" th:object="${test}" method="post" class="mb-4 p-3 border rounded">
        <input type="hidden" th:field="*{id}">
        <div class="row">
            <div class="col-md-3 mb-2">
                <input type="text" class="form-control" th:field="*{name}" placeholder="Tên bài khảo sát" required>
            </div>
            <div class="col-md-4 mb-2">
                <input type="text" class="form-control" th:field="*{topic}" placeholder="Chủ đề">
            </div>
            <div class="col-md-3 mb-2">
                <input type="text" class="form-control" th:field="*{status}" placeholder="Trạng thái">
            </div>
            <div class="col-md-2 mb-2">
                <button class="btn btn-success w-100" type="submit">Lưu thông tin</button>
            </div>
        </div>
        <textarea class="form-control mt-2" th:field="*{description}" placeholder="Mô tả"></textarea>
    </form>

    <!-- Thêm câu hỏi mới -->
    <form th:action="@{|/admin/tests/${test.id}/question/save|}" method="post" class="inline-form mb-3">
        <input type="hidden" name="id">
        <input type="hidden" name="testId" th:value="${test.id}">
        <input type="text" name="content" class="form-control d-inline" placeholder="Thêm câu hỏi mới" style="width:380px;display:inline-block;" required>
        <button class="btn btn-primary ms-2">+ Thêm câu hỏi</button>
    </form>

    <hr>
    <!-- Hiển thị tất cả câu hỏi & đáp án -->
    <div th:each="question : ${questions}">
        <div class="inline-edit p-2">
            <form th:action="@{|/admin/tests/${test.id}/question/save|}" method="post" class="inline-form">
                <input type="hidden" name="id" th:value="${question.id}">
                <input type="hidden" name="testId" th:value="${test.id}">
                <input type="text" name="content" th:value="${question.content}" class="form-control d-inline" style="width:380px;display:inline-block;" required>
                <button class="btn btn-success btn-sm ms-2" type="submit">Lưu</button>
                <a th:href="@{|/admin/tests/${test.id}/question/delete?id=${question.id}|}" class="btn btn-danger btn-sm ms-1" onclick="return confirm('Xóa câu hỏi này?');">Xóa</a>
            </form>
            <!-- Form thêm đáp án -->
            <form th:action="@{|/admin/tests/${test.id}/question/${question.id}/answer/save|}" method="post" class="inline-form answer-row ms-4 mt-2">
                <input type="hidden" name="id">
                <input type="hidden" name="questionId" th:value="${question.id}">
                <input type="text" name="content" class="form-control d-inline" placeholder="Thêm đáp án" style="width:250px;display:inline-block;" required>
                <select name="isCorrect" class="form-select d-inline" style="width:80px;display:inline-block;">
                    <option value="true">Đúng</option>
                    <option value="false">Sai</option>
                </select>
                <button class="btn btn-primary btn-sm ms-2">+ Thêm đáp án</button>
            </form>
            <!-- Danh sách đáp án -->
            <div class="answer-row ms-4">
                <div th:each="answer : ${question.answers}">
                    <form th:action="@{|/admin/tests/${test.id}/question/${question.id}/answer/save|}" method="post" class="inline-form">
                        <input type="hidden" name="id" th:value="${answer.id}">
                        <input type="hidden" name="questionId" th:value="${question.id}">
                        <input type="text" name="content" th:value="${answer.content}" class="form-control d-inline" style="width:210px;display:inline-block;" required>
                        <select name="isCorrect" th:value="${answer.isCorrect}" class="form-select d-inline" style="width:80px;display:inline-block;">
                            <option th:value="true" th:selected="${answer.isCorrect}">Đúng</option>
                            <option th:value="false" th:selected="${!answer.isCorrect}">Sai</option>
                        </select>
                        <button class="btn btn-success btn-sm ms-2" type="submit">Lưu</button>
                        <a th:href="@{|/admin/tests/${test.id}/question/${question.id}/answer/delete?id=${answer.id}|}" class="btn btn-danger btn-sm ms-1" onclick="return confirm('Xóa đáp án này?');">Xóa</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <a href="/admin/tests" class="btn btn-secondary mt-3">Quay lại</a>
</div>
</body>
</html>
