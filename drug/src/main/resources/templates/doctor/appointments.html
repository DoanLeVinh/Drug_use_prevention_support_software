<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lịch hẹn của bác sĩ</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <!-- Font & Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2176ae;
            --primary-light: #e1f0fa;
            --secondary: #57b8ff;
            --success: #21ae66;
            --soft: #f8fbfe;
            --white: #fff;
            --gray: #f0f4f8;
            --danger: #e74c3c;
            --text-primary: #183a55;
            --text-secondary: #5a7a94;
            --shadow-sm: 0 2px 8px rgba(33, 118, 174, 0.08);
            --shadow-md: 0 4px 16px rgba(33, 118, 174, 0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        body {
            background: var(--soft);
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            color: var(--text-primary);
            margin: 0;
            min-width: 0;
            overflow-x: hidden !important;
        }
        .main-container {
            display: flex;
            min-height: 100vh;
        }
        .dashboard-wrap {
            flex: 1;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        .section-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: fadeInDown 0.5s;
        }
        @keyframes fadeInDown {
            from { opacity:0; transform: translateY(-20px);}
            to { opacity:1; transform: translateY(0);}
        }
        /* Bộ lọc và tìm kiếm */
        .filter-row {
            margin-bottom: 1.25rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        .filter-row input, .filter-row select {
            padding: 0.625rem 1rem;
            border-radius: var(--radius-sm);
            border: 1px solid #d6e7f5;
            font-size: 0.95rem;
            background: var(--white);
            min-width: 180px;
            color: var(--text-primary);
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }
        .filter-row input:focus, .filter-row select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(87, 184, 255, 0.15);
        }
        /* Bảng lịch hẹn */
        .booking-table-container {
            width: 100%;
            overflow-x: auto;
        }
        .booking-table-wrap {
            background: var(--white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            min-width: fit-content;
        }
        .booking-table {
            border-collapse: collapse;
            width: 100%;
        }
        .booking-table th, .booking-table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--gray);
            white-space: nowrap;
            font-size: 0.96rem;
        }
        .booking-table th {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 0.93rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            position: sticky;
            top: 0;
            z-index: 2;
        }
        .booking-table tr {
            transition: background 0.12s;
        }
        .booking-table tr:hover {
            background: var(--soft);
        }
        .status-badge {
            font-weight: 600;
            padding: 3px 18px;
            border-radius: 14px;
            font-size: 0.97em;
            display: inline-block;
            letter-spacing: 0.01em;
        }
        .status-wait {
            background: #fff7e6;
            color: #ad7202;
        }
        .status-confirmed {
            background: #eafcf4;
            color: var(--success);
        }
        .status-cancelled {
            background: #f7f7f7;
            color: #aaa;
        }
        .status-done {
            background: #e1f3fa;
            color: var(--primary);
        }
        /* Nút cập nhật trạng thái */
        .status-form {
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        .status-form select {
            border-radius: var(--radius-sm);
            border: 1px solid #d6e7f5;
            font-size: 0.92rem;
            min-width: 120px;
            background: var(--white);
            color: var(--text-primary);
            padding: 0.36rem 0.6rem;
            transition: all 0.2s;
        }
        .status-form select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(87, 184, 255, 0.12);
        }
        .status-form button {
            border: none;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: var(--radius-sm);
            padding: 0.4rem 0.9rem;
            margin: 0 0.13rem;
            font-weight: 600;
            font-size: 0.92rem;
            transition: all 0.18s;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .status-form button:hover {
            background: var(--primary);
            color: #fff;
        }
        @media (max-width: 992px) {
            .dashboard-wrap { padding: 1.25rem;}
        }
        @media (max-width: 576px) {
            .dashboard-wrap { padding: 0.5rem;}
            .section-title { font-size: 1rem;}
            .booking-table th, .booking-table td { padding: 0.7rem 0.4rem; font-size: 0.83rem;}
            .status-form button { font-size: 0.77rem; padding: 0.22rem 0.5rem;}
        }
    </style>
</head>
<body>
        <div th:replace="doctor/header :: main-header"></div>

    <div class="main-container">
        <div class="dashboard-wrap">
            <div class="section-title">
                <i class="fa-solid fa-calendar-check"></i> Lịch hẹn của bác sĩ
            </div>
            <!-- Bộ lọc trạng thái và tìm kiếm -->
            <div class="filter-row">
                <select id="statusFilter">
                    <option value="">-- Lọc theo trạng thái --</option>
                    <option value="Chờ xác nhận">Chờ xác nhận</option>
                    <option value="Đã xác nhận">Đã xác nhận</option>
                    <option value="Đã hủy">Hoàn thành</option>
                    <option value="Đã tư vấn">Đã hủy</option>
                </select>
                <input type="text" id="searchInput" placeholder="Tìm kiếm theo tên bệnh nhân hoặc số điện thoại...">
            </div>

            <div class="booking-table-container">
                <div class="booking-table-wrap">
                    <table class="booking-table" id="bookingTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ngày đặt</th>
                            <th>Giờ</th>
                            <th>Bệnh nhân</th>
                            <th>Email</th>
                            <th>Điện thoại</th>
                            <th>Dịch vụ</th>
                            <th>Loại tư vấn</th>
                            <th>Trạng thái</th>
                            <th>Cập nhật trạng thái</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="b : ${appointments}">
                            <td th:text="${b.id}"></td>
                            <td th:text="${b.bookingDate}"></td>
                            <td th:text="${b.bookingTime}"></td>
                            <td th:text="${b.fullname}" class="fullname"></td>
                            <td th:text="${b.email}"></td>
                            <td th:text="${b.phone}" class="phone"></td>
                            <td th:text="${b.service}"></td>
                            <td th:text="${b.consultationType}"></td>
                            <td>
                                <span th:if="${b.status} == 'Chờ xác nhận'" th:text="${b.status}" class="status-badge status-wait"></span>
                                <span th:if="${b.status} == 'Đã xác nhận'" th:text="${b.status}" class="status-badge status-confirmed"></span>
                                <span th:if="${b.status} == 'Hoàn thành'" th:text="${b.status}" class="status-badge status-cancelled"></span>
                                <span th:if="${b.status} == 'Đã hủy'" th:text="${b.status}" class="status-badge status-done"></span>
                                <span th:if="${!(b.status == 'Chờ xác nhận' or b.status == 'Đã xác nhận' or b.status == 'Hoàn thành' or b.status == 'Đã hủy')}" th:text="${b.status}" class="status-badge"></span>
                            </td>
                            <td>
                                <form th:action="@{/doctor/appointments/update-status}" method="post" class="status-form">
                                    <input type="hidden" name="bookingId" th:value="${b.id}"/>
                                    <select name="status" required>
                                        <option th:selected="${b.status == 'Chờ xác nhận'}">Chờ xác nhận</option>
                                        <option th:selected="${b.status == 'Đã xác nhận'}">Đã xác nhận</option>
                                        <option th:selected="${b.status == 'Hoàn thành'}">Hoàn thành</option>
                                        <option th:selected="${b.status == 'Đã hủy'}">Đã hủy</option>
                                    </select>
                                    <button type="submit"><i class="fa fa-save"></i> Lưu</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- Script lọc bảng bằng JS -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const statusFilter = document.getElementById('statusFilter');
            const searchInput = document.getElementById('searchInput');
            const table = document.getElementById('bookingTable');
            const rows = table.querySelectorAll('tbody tr');

            function filterTable() {
                const selectedStatus = statusFilter.value.trim().toLowerCase();
                const searchValue = searchInput.value.trim().toLowerCase();

                rows.forEach(row => {
                    const fullname = row.querySelector('.fullname').textContent.trim().toLowerCase();
                    const phone = row.querySelector('.phone').textContent.trim().toLowerCase();
                    let status = "";
                    // Lấy đúng badge có trạng thái thực
                    row.querySelectorAll('.status-badge').forEach(badge => {
                        if(badge.textContent) status = badge.textContent.trim().toLowerCase();
                    });

                    const statusMatch = !selectedStatus || status === selectedStatus;
                    const searchMatch =
                        !searchValue ||
                        fullname.includes(searchValue) ||
                        phone.includes(searchValue);

                    row.style.display = (statusMatch && searchMatch) ? '' : 'none';
                });
            }

            statusFilter.addEventListener('change', filterTable);
            searchInput.addEventListener('input', filterTable);
        });
    </script>
</body>
</html>
